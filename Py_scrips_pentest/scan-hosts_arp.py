# Created: 14|08|2021
# Description: check hosts (ICMP protocol)
# Command: sudo python scan-hosts_arp.py interface ip-range/prefix
# E.g. sudo python scan-hosts_arp.py eth0 192.168.1.0/24
# Required: python-scrapy 

from scapy.all import *
import sys
import time

time_created = time.localtime()

interface = sys.argv[1]
ip_range = sys.argv[2]
broadcastMac = "ff:ff:ff:ff:ff:ff"

packet = Ether(dst=broadcastMac)/ARP(pdst = ip_range) 
ans, unans = srp(packet, timeout =2, iface=interface, inter=0.1)

    
print("\n# Starting checked hosts with ICMP (scan-hosts_arp.py) at " + time.strftime("%H:%M:%S %m.%d.%Y", time_created))

for send,receive in ans:
    print(receive.sprintf(r"%Ether.src% - %ARP.psrc%"))    
else:
    time_done = time.localtime()
    print("# Script done at " + time.strftime("%H:%M:%S %m.%d.%Y", time_done) + ' | Scanned in: ', time_done[4]-time_created[4],'minutes', time_done[5]-time_created[5], 'senconds\n')

