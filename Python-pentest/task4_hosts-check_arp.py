# Created: 14|08|2021
# Description: check hosts (arp)
# Script: hosts-check_arp.py
# Command: sudo python script interface ip-range/prefix
# Requirement: python-scrapy





from scapy.all import *
import sys
import time

try:
    sys.argv[2]
except:
    print("\n# Command: sudo python script.py interface ip-range/prefix")
    print("# eg: sudo python script.py eth0 192.168.1.0/24")
    quit()

interface = sys.argv[1]
ip_range = sys.argv[2]
broadcastMac = "ff:ff:ff:ff:ff:ff"

packet = Ether(dst=broadcastMac)/ARP(pdst = ip_range) 
ans, unans = srp(packet, timeout =2, iface=interface, inter=0.1)

    
print("\n# Start %s at " %(sys.argv[0]) + time.strftime("%H:%M:%S %m.%d.%Y", time.localtime()))
print("# IP-range:", sys.argv[2])

for send,receive in ans:
    sys.stdout.flush() 
    print(receive.sprintf(r"%Ether.src% - %ARP.psrc%"))
else:
    print("# Script done at " + time.strftime("%H:%M:%S %m.%d.%Y", time.localtime()) + "\n")
